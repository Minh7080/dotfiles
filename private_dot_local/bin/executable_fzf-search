#!/bin/dash

file=$(fd . --type f $@ | fzf --layout=reverse --preview='echo $(basename {}); echo; bat --plain --color=always {}')

[ -z "$file" ] && return 1

file=$(realpath -q "$file")
dir=$(dirname "$file")

cd "$dir"

TYPES_REGEX='^text/|^application/javascript|^application/json|^application/x-python-code|^application/x-sh'

if file -b --mime-type "$file" | grep -Eq "$TYPES_REGEX"; then
    "$EDITOR" "$file"
else
    nohup xdg-open "$file" >/dev/null 2>&1 &
fi
