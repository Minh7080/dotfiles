#!/bin/dash

remote_dest="z5662654@login.cse.unsw.edu.au:/home/z5662654/Workspace/"

[ "$#" -lt 1 ] && { echo "Please provide a command"; exit 1; }

case "$1" in
    mount)
        mountpoint -q /mnt/UNSW_remote/ && echo "Already mounted" || 
            sshfs -o cache=yes -o kernel_cache -o attr_timeout=600 \
            -o entry_timeout=3600 -o negative_timeout=600 \
            -o reconnect \
            -o ssh_command="ssh -o ServerAliveInterval=15 -o ServerAliveCountMax=3" \
            z5662654@login.cse.unsw.edu.au:/home/z5662654/ /mnt/UNSW_remote/
        ;;
    umount)
        mountpoint -q /mnt/UNSW_remote/ || { echo "Not mounted"; false; } &&
            umount /mnt/UNSW_remote/
        ;;
    ssh)
        ssh -Y z5662654@login.cse.unsw.edu.au
        ;;
    push)
        shift
        rsync $@ $remote_dest
        ;;
    pull)
        rsync -avL ${remote_dest}$2 .
        ;;
    *)
        echo "Usage: cse {mount|umount|ssh|push|pull}"
        exit 1
        ;;
esac
